<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minstay | Secure Founder Panel</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        #adminDashboard, #loginGate { display: none; }

        /* Login Centering */
        .login-container { height: 100vh; display: flex; align-items: center; justify-content: center; background: #f0f2f5; }
        .login-card { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }

        /* Stacked Layout Styling */
        .admin-content-wrap { max-width: 900px; margin: 40px auto; padding: 0 20px; display: flex; flex-direction: column; gap: 40px; }
        .admin-card { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.04); border: 1px solid #f0f0f0; }

        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #f8f9fa; padding-bottom: 15px; }
        .section-header h3 { font-size: 1.5rem; font-weight: 800; color: var(--dark); }

        /* Property Add Logic UI */
        .type-selector { background: #f8f9fa; padding: 25px; border-radius: 18px; margin: 20px 0; border: 1px solid #eee; }
        .check-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; cursor: pointer; font-weight: 700; }
        .check-item input { width: 20px; height: 20px; accent-color: var(--primary); }

        .price-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .price-section { display: none; animation: fadeInUp 0.4s ease; }
        .price-section.active { display: block; }

        /* Inquiry Table Styling */
        .table-responsive { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th { text-align: left; color: #9aa0a6; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; padding: 15px; }
        td { padding: 15px; border-top: 1px solid #f8f9fa; vertical-align: middle; }
        .inquiry-tag { padding: 5px 12px; border-radius: 50px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .tag-pg { background: #e8f0fe; color: #1a73e8; }
        .tag-short { background: #e6f7ef; color: #25d366; }

        /* New Property List Styling */
        .tab-btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; border-radius: 50px; border: 1px solid #eee; background: #fff; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .property-list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border: 1px solid #f0f0f0; border-radius: 12px; margin-bottom: 10px; }
        .btn-delete { color: var(--danger); background: none; border: none; font-weight: 700; cursor: pointer; }

        .btn-logout { background: #fee2e2; color: #dc2626; padding: 10px 20px; border-radius: 50px; border: none; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .btn-logout:hover { background: #fecaca; transform: scale(1.05); }

        @media (max-width: 600px) { .price-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div id="loginGate" class="login-container">
        <div class="login-card scale-in">
            <h2 style="margin-bottom: 10px;">Founder Portal</h2>
            <p style="color: #666; margin-bottom: 30px;">Minstay Management Access</p>
            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Registered Email" required>
                <input type="password" id="loginPass" placeholder="Security Password" required>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 10px;">Verify & Enter</button>
            </form>
        </div>
    </div>

    <div id="adminDashboard">
        <nav class="navbar">
            <a href="index.html" class="logo"><span>Minstay</span> </a>
            <div style="display: flex; gap: 15px; align-items: center;">
                <button class="btn-logout" onclick="handleLogout()">Logout</button>
            </div>
        </nav>

        <div class="admin-content-wrap">
            <div class="admin-card fadeInUp">
                <div class="section-header">
                    <h3>List New Property</h3>
                </div>
                <form id="addStayForm">
                    <label>Property Name / Exact Location</label>
                    <input type="text" id="stayLocation" placeholder="e.g. Near IIT Guwahati, North Amingaon" required>

                    <div class="type-selector">
                        <p style="font-size: 14px; margin-bottom: 15px; color: #555;">Which services are available here?</p>
                        <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                            <label class="check-item">
                                <input type="checkbox" id="checkShort" onchange="toggleInputs()"> Short Term Stay
                            </label>
                            <label class="check-item">
                                <input type="checkbox" id="checkPG" onchange="toggleInputs()"> Long Term PG
                            </label>
                        </div>
                    </div>

                    <div class="price-grid">
                        <div id="shortPriceSection" class="price-section">
                            <label style="font-size: 13px; font-weight: 700;">Nightly Price (Rs.)</label>
                            <input type="number" id="shortPrice" placeholder="Price per night">
                        </div>
                        <div id="pgPriceSection" class="price-section">
                            <label style="font-size: 13px; font-weight: 700;">Monthly Rent (Rs.)</label>
                            <input type="number" id="pgPrice" placeholder="Price per month">
                        </div>
                    </div>

                    <label style="margin-top: 20px; display: block;">Image Link (Drive/Direct Link)</label>
                    <input type="text" id="stayImage" placeholder="Paste property image URL" required>
                    <button type="submit" class="btn-submit" style="background: var(--primary); margin-top: 25px; height: 60px;">Publish to Platform</button>
                </form>
            </div>

            <div class="admin-card fadeInUp" style="animation-delay: 0.1s;">
                <div class="section-header">
                    <h3>Manage Listed Properties</h3>
                </div>
                <div class="tab-btn-group">
                    <button id="tabBtnShort" class="tab-btn active" onclick="switchPropTab('short')">Short Stays</button>
                    <button id="tabBtnPG" class="tab-btn" onclick="switchPropTab('pg')">Long Term PGs</button>
                </div>
                <div id="propertyListContainer">
                    </div>
            </div>

            <div class="admin-card fadeInUp" style="animation-delay: 0.2s;">
                <div class="section-header">
                    <h3>Customer Inquiries</h3>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Customer Details</th>
                                <th>Location</th>
                                <th>Stay Type</th>
                                <th>Check-in</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBYh8ffNvS1Chq9F_K2I49v1N_X429BxpM",
            authDomain: "lowest-price-stay.firebaseapp.com",
            projectId: "lowest-price-stay",
            storageBucket: "lowest-price-stay.firebasestorage.app",
            messagingSenderId: "674887550826",
            appId: "1:674887550826:web:8a44c2c27b30d3e9808713"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // PERSISTENCE & SESSION
        auth.setPersistence(firebase.auth.Auth.Persistence.SESSION);

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadBookings();
                loadProperties('short'); 
            } else {
                document.getElementById('loginGate').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
            }
        });

        // AUTO-LOGOUT
        window.addEventListener('pagehide', () => { auth.signOut(); });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            auth.signInWithEmailAndPassword(email, pass).catch(err => alert("Unauthorized: " + err.message));
        });

        function handleLogout() { auth.signOut(); }

        function toggleInputs() {
            document.getElementById('shortPriceSection').classList.toggle('active', document.getElementById('checkShort').checked);
            document.getElementById('pgPriceSection').classList.toggle('active', document.getElementById('checkPG').checked);
        }

        // MANAGEMENT TABS LOGIC
        let currentPropType = 'short';
        function switchPropTab(type) {
            currentPropType = type;
            document.getElementById('tabBtnShort').classList.toggle('active', type === 'short');
            document.getElementById('tabBtnPG').classList.toggle('active', type === 'pg');
            loadProperties(type);
        }

        function loadProperties(type) {
            const container = document.getElementById('propertyListContainer');
            const fieldToCheck = type === 'short' ? 'isShortStay' : 'isPG';

            db.collection('listed_stays').where(fieldToCheck, '==', true).onSnapshot(snap => {
                container.innerHTML = '';
                if(snap.empty) container.innerHTML = '<p style="color:#888;">No properties listed here yet.</p>';
                snap.forEach(doc => {
                    const p = doc.data();
                    const price = type === 'short' ? p.shortPrice : p.pgPrice;
                    container.innerHTML += `
                        <div class="property-list-item">
                            <div>
                                <strong style="display:block;">${p.location}</strong>
                                <small style="color:var(--primary);">Rs. ${price} / ${type === 'short' ? 'night' : 'month'}</small>
                            </div>
                            <button class="btn-delete" onclick="deleteProperty('${doc.id}')">Delete</button>
                        </div>`;
                });
            });
        }

        async function deleteProperty(id) {
            if(confirm("Confirm removal of this property?")) {
                await db.collection('listed_stays').doc(id).delete();
                alert("Property Deleted.");
            }
        }

        // ADD PROPERTY LOGIC
        document.getElementById('addStayForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const isShort = document.getElementById('checkShort').checked;
            const isPG = document.getElementById('checkPG').checked;
            if(!isShort && !isPG) return alert("Select at least one category!");

            try {
                // Ensure imageLink field matches script.js reader
                await db.collection('listed_stays').add({
                    location: document.getElementById('stayLocation').value,
                    imageLink: document.getElementById('stayImage').value,
                    isShortStay: isShort,
                    isPG: isPG,
                    shortPrice: isShort ? document.getElementById('shortPrice').value : null,
                    pgPrice: isPG ? document.getElementById('pgPrice').value : null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Property is now Live!");
                document.getElementById('addStayForm').reset();
                toggleInputs();
            } catch (err) { alert(err.message); }
        });

        // INQUIRIES LOAD
        function loadBookings() {
            db.collection('bookings').orderBy('timestamp', 'desc').onSnapshot(snap => {
                const list = document.getElementById('bookingsList');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const b = doc.data();
                    const tagClass = b.type === 'PG' ? 'tag-pg' : 'tag-short';
                    list.innerHTML += `
                        <tr>
                            <td><div style="font-weight:800;">${b.name}</div><div style="font-size:12px; color:#888;">${b.gender}</div></td>
                            <td>${b.location}</td>
                            <td><span class="inquiry-tag ${tagClass}">${b.type}</span></td>
                            <td style="font-weight:600; font-size:13px;">${b.fromDate}</td>
                        </tr>`;
                });
            });
        }
    </script>
</body>
</html>
