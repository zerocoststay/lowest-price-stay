<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minstay | Secure Founder Panel</title>
    
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --primary: #1a73e8;
            --danger: #dc2626;
            --dark: #222;
            --gray: #717171;
        }

        body { background-color: #f7f9fc; min-height: 100vh; display: flex; flex-direction: column; }
        
        #adminDashboard, #loginGate { display: none; width: 100%; }

        /* Login Centering */
        .login-container { height: 100vh; display: flex; align-items: center; justify-content: center; background: #f0f2f5; }
        .login-card { background: white; padding: 40px; border-radius: 24px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .login-card input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 12px; outline: none; }

        /* Admin Navbar Overrides */
        .admin-nav { background: white; border-bottom: 1px solid #eee; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .admin-nav .logo { font-weight: 800; font-size: 1.5rem; color: var(--primary); text-decoration: none; }

        /* Stacked Layout Styling */
        .admin-content-wrap { max-width: 1000px; margin: 40px auto; padding: 0 20px; display: flex; flex-direction: column; gap: 30px; }
        .admin-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid #eee; }

        .section-header { margin-bottom: 25px; border-bottom: 2px solid #f8f9fa; padding-bottom: 15px; }
        .section-header h3 { font-size: 1.4rem; font-weight: 800; color: var(--dark); display: flex; align-items: center; gap: 10px; }

        /* Form Styling */
        form label { display: block; font-size: 13px; font-weight: 700; margin-bottom: 8px; color: var(--dark); }
        form input, form select { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 10px; font-size: 14px; outline: none; }
        
        .type-selector { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .check-group { display: flex; gap: 20px; }
        .check-item { display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: 600; font-size: 14px; }
        .check-item input { width: 18px; height: 18px; margin: 0; accent-color: var(--primary); }

        .price-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .price-section { display: none; }
        .price-section.active { display: block; }

        /* Property Management List */
        .tab-btn-group { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .tab-btn { padding: 8px 18px; border-radius: 50px; border: 1px solid #eee; background: #fff; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .property-list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f8f9fa; }
        .property-list-item:last-child { border-bottom: none; }
        .btn-delete { color: var(--danger); background: none; border: none; font-weight: 700; cursor: pointer; font-size: 13px; }

        /* Inquiry Table */
        .table-responsive { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--gray); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; padding: 12px; background: #fafafa; }
        td { padding: 12px; border-bottom: 1px solid #f8f9fa; font-size: 13px; }
        .inquiry-tag { padding: 4px 10px; border-radius: 50px; font-size: 10px; font-weight: 800; }
        .tag-pg { background: #e8f0fe; color: #1a73e8; }
        .tag-short { background: #e6f7ef; color: #25d366; }

        .btn-logout { background: #fee2e2; color: #dc2626; padding: 8px 16px; border-radius: 50px; border: none; font-weight: 700; cursor: pointer; font-size: 13px; }

        @media (max-width: 600px) { .price-grid { grid-template-columns: 1fr; } .check-group { flex-direction: column; gap: 10px; } }
    </style>
</head>
<body>

    <div id="loginGate" class="login-container">
        <div class="login-card">
            <h2>Minstay Founder</h2>
            <p style="color: #666; margin-bottom: 30px; font-size: 14px;">Secure Management Access</p>
            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Registered Email" required>
                <input type="password" id="loginPass" placeholder="Security Password" required>
                <button type="submit" class="btn-book" style="width: 100%; padding: 14px;">Verify & Enter</button>
            </form>
        </div>
    </div>

    <div id="adminDashboard">
        <nav class="admin-nav">
            <a href="#" class="logo">Minstay Panel</a>
            <button class="btn-logout" onclick="handleLogout()">Logout</button>
        </nav>

        <div class="admin-content-wrap">
            
            <div class="admin-card">
                <div class="section-header">
                    <h3><i class="fas fa-plus-circle"></i> List New Property</h3>
                </div>
                <form id="addStayForm">
                    <label>Property Display Name & Location</label>
                    <input type="text" id="stayLocation" placeholder="e.g. Near IIT Guwahati, North Amingaon" required>

                    <label>Assign to State (Page Visibility)</label>
                    <select id="stayState" required>
                        <option value="">-- Select State --</option>
                        <option value="assam">Assam</option>
                        <option value="mizoram">Mizoram</option>
                    </select>

                    <div class="type-selector">
                        <label style="margin-bottom: 12px; display: block;">Stay Category</label>
                        <div class="check-group">
                            <label class="check-item">
                                <input type="checkbox" id="checkShort" onchange="toggleInputs()"> Short Term (Daily)
                            </label>
                            <label class="check-item">
                                <input type="checkbox" id="checkPG" onchange="toggleInputs()"> Long Term (PG)
                            </label>
                        </div>
                    </div>

                    <div class="price-grid">
                        <div id="shortPriceSection" class="price-section">
                            <label>Nightly Rate (₹)</label>
                            <input type="number" id="shortPrice" placeholder="per night">
                            
                            <div style="margin-top: 15px; padding: 10px; background: #e6f7ef; border-radius: 8px; border: 1px solid #25d366;">
                                <label class="check-item" style="margin-bottom: 0; color: #047857;">
                                    <input type="checkbox" id="checkFood"> <strong>Include "Food Included" Badge?</strong>
                                </label>
                            </div>
                        </div>
                        <div id="pgPriceSection" class="price-section">
                            <label>Monthly Rent (₹)</label>
                            <input type="number" id="pgPrice" placeholder="per month">
                        </div>
                    </div>

                    <label style="margin-top: 20px;">Image Link (Direct URL)</label>
                    <input type="text" id="stayImage" placeholder="Paste property image URL" required>

                    <button type="submit" class="btn-book" style="width: 100%; padding: 16px; font-size: 1rem;">Publish to Platform</button>
                </form>
            </div>

            <div class="admin-card">
                <div class="section-header">
                    <h3><i class="fas fa-tasks"></i> Manage Listed Properties</h3>
                </div>
                <div class="tab-btn-group">
                    <button id="tabBtnShort" class="tab-btn active" onclick="switchPropTab('short')">Short Stays</button>
                    <button id="tabBtnPG" class="tab-btn" onclick="switchPropTab('pg')">Long Term PGs</button>
                </div>
                <div id="propertyListContainer">
                    </div>
            </div>

            <div class="admin-card">
                <div class="section-header">
                    <h3><i class="fas fa-envelope-open-text"></i> Recent Inquiries</h3>
                </div>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>Customer</th>
                                <th>Location</th>
                                <th>Type</th>
                                <th>Check-in</th>
                            </tr>
                        </thead>
                        <tbody id="bookingsList">
                            </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBYh8ffNvS1Chq9F_K2I49v1N_X429BxpM",
            authDomain: "lowest-price-stay.firebaseapp.com",
            projectId: "lowest-price-stay",
            storageBucket: "lowest-price-stay.firebasestorage.app",
            messagingSenderId: "674887550826",
            appId: "1:674887550826:web:8a44c2c27b30d3e9808713"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        auth.setPersistence(firebase.auth.Auth.Persistence.SESSION);

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadBookings();
                loadProperties('short'); 
            } else {
                document.getElementById('loginGate').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
            }
        });

        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            auth.signInWithEmailAndPassword(email, pass).catch(err => alert("Unauthorized: " + err.message));
        });

        function handleLogout() { auth.signOut(); }

        function toggleInputs() {
            document.getElementById('shortPriceSection').classList.toggle('active', document.getElementById('checkShort').checked);
            document.getElementById('pgPriceSection').classList.toggle('active', document.getElementById('checkPG').checked);
        }

        let currentPropType = 'short';
        function switchPropTab(type) {
            currentPropType = type;
            document.getElementById('tabBtnShort').classList.toggle('active', type === 'short');
            document.getElementById('tabBtnPG').classList.toggle('active', type === 'pg');
            loadProperties(type);
        }

        function loadProperties(type) {
            const container = document.getElementById('propertyListContainer');
            const fieldToCheck = type === 'short' ? 'isShortStay' : 'isPG';

            db.collection('listed_stays').where(fieldToCheck, '==', true).onSnapshot(snap => {
                container.innerHTML = '';
                if(snap.empty) container.innerHTML = '<p style="color:#888; font-size:13px;">No properties listed here yet.</p>';
                snap.forEach(doc => {
                    const p = doc.data();
                    const price = type === 'short' ? p.shortPrice : p.pgPrice;
                    // Logic to show Food Included label in list if applicable
                    let foodLabel = (type === 'short' && p.isFoodIncluded) ? '<span style="color:#27ae60; font-size:10px; font-weight:800;">[FOOD INCLUDED]</span> ' : '';

                    container.innerHTML += `
                        <div class="property-list-item">
                            <div>
                                <strong style="display:block; font-size:14px;">${foodLabel}${p.location}</strong>
                                <small style="color:var(--gray); text-transform: uppercase; font-size: 10px;">State: ${p.state || 'Generic'}</small><br>
                                <small style="color:var(--primary); font-weight:700;">₹${price} / ${type === 'short' ? 'night' : 'month'}</small>
                            </div>
                            <button class="btn-delete" onclick="deleteProperty('${doc.id}')">Remove</button>
                        </div>`;
                });
            });
        }

        async function deleteProperty(id) {
            if(confirm("Confirm removal of this property?")) {
                await db.collection('listed_stays').doc(id).delete();
            }
        }

        document.getElementById('addStayForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const isShort = document.getElementById('checkShort').checked;
            const isPG = document.getElementById('checkPG').checked;
            const state = document.getElementById('stayState').value;
            // Get Food status only if short stay is selected
            const isFoodIncluded = isShort ? document.getElementById('checkFood').checked : false;

            if(!isShort && !isPG) return alert("Select at least one category!");
            if(!state) return alert("Please select a state!");

            try {
                await db.collection('listed_stays').add({
                    location: document.getElementById('stayLocation').value,
                    state: state,
                    imageLink: document.getElementById('stayImage').value,
                    isShortStay: isShort,
                    isPG: isPG,
                    shortPrice: isShort ? document.getElementById('shortPrice').value : null,
                    pgPrice: isPG ? document.getElementById('pgPrice').value : null,
                    isFoodIncluded: isFoodIncluded, // Save to database
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("Successfully listed for " + state);
                document.getElementById('addStayForm').reset();
                toggleInputs();
                // Reset checkbox manually
                document.getElementById('checkFood').checked = false;
            } catch (err) { alert(err.message); }
        });

        function loadBookings() {
            db.collection('bookings').orderBy('timestamp', 'desc').onSnapshot(snap => {
                const list = document.getElementById('bookingsList');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const b = doc.data();
                    const tagClass = b.type === 'PG' ? 'tag-pg' : 'tag-short';
                    list.innerHTML += `
                        <tr>
                            <td><div style="font-weight:700;">${b.name}</div><div style="font-size:11px; color:#888;">${b.gender}</div></td>
                            <td>${b.location}</td>
                            <td><span class="inquiry-tag ${tagClass}">${b.type}</span></td>
                            <td style="font-weight:600;">${b.fromDate}</td>
                        </tr>`;
                });
            });
        }
    </script>
</body>
</html>
